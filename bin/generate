#!/usr/bin/env ruby
# frozen_string_literal: true

start_time = Process.clock_gettime(Process::CLOCK_MONOTONIC)

require_relative "../config/application"

# clobber clobber
FileUtils.mkdir_p("out")
FileUtils.rm_r("out")
FileUtils.mkdir_p("out")

# reading
site = Site.new

# writing
site.posts.each do |path, post|
  File.open("out/#{path}", "w:utf-8") do |f|
    f << post.html
  end
end

File.open("out/index.html", "w:utf-8") do |f|
  f << site.index.html
end

File.open("out/feed", "w:utf-8") do |f|
  f << site.index.feed
end

File.open("out/404.html", "w:utf-8") do |f|
  f << site.not_found.html
end

Dir["public/*"].each do |file|
  FileUtils.cp_r(file, "out/#{File.basename(file)}")
end

puts "Generated in %.03f seconds" % (Process.clock_gettime(Process::CLOCK_MONOTONIC) - start_time).round(3)
